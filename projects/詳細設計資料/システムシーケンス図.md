# システムシーケンス図

## 📋 概要

アルゴリズム開発効率化システムの主要な処理フローを時系列で表現したシーケンス図です。

## 🏗️ システム全体構成図

### アルゴリズム開発エンジン環境の詳細構成
```mermaid
graph LR
    subgraph "エンジン別Docker環境"
        subgraph "評価エンジン (evaluation-engine)"
            EvalCore[評価コア<br/>OpenCV + dlib]
            EvalData[(評価データ<br/>動画・CSV)]
            EvalResults[(評価結果<br/>JSON/CSV)]
        end
        
        subgraph "AI分析エンジン (ai-analysis-engine)"
            AICore[AI分析コア<br/>OpenAI/Claude]
            AnalysisData[(分析データ<br/>評価結果)]
            JupyterReports[Jupyter Notebook<br/>レポート]
        end
        
        subgraph "改善提案エンジン (improvement-engine)"
            ImproveCore[改善提案コア<br/>AI分析結果処理]
            SuggestionData[(改善提案<br/>優先度・実装案)]
            PriorityMatrix[優先度マトリックス<br/>影響度×緊急度]
        end
        
        subgraph "課題管理エンジン (issue-management-engine)"
            IssueCore[課題管理コア<br/>GitHub Issues連携]
            IssueData[(課題データ<br/>進捗・効果測定)]
            EffectMeasurement[効果測定<br/>修正前後比較]
        end
    end
    
    subgraph "外部連携"
        GitHub[GitHub Actions]
        PersonalData[Personal_Data<br/>個人情報分離]
        ExternalTools[External Tools<br/>Git submodules]
    end
    
    %% 評価エンジンの連携
    EvalCore --> EvalData
    EvalCore --> EvalResults
    
    %% AI分析エンジンの連携
    EvalResults --> AICore
    AICore --> AnalysisData
    AICore --> JupyterReports
    
    %% 改善提案エンジンの連携
    AnalysisData --> ImproveCore
    ImproveCore --> SuggestionData
    ImproveCore --> PriorityMatrix
    
    %% 課題管理エンジンの連携
    SuggestionData --> IssueCore
    IssueCore --> IssueData
    IssueCore --> EffectMeasurement
    
    %% 外部連携
    GitHub --> EvalCore
    GitHub --> AICore
    GitHub --> ImproveCore
    GitHub --> IssueCore
    
    PersonalData --> EvalData
    ExternalTools --> EvalCore
    
    %% スタイル設定
    classDef evalClass fill:#e1f5fe
    classDef aiClass fill:#f3e5f5
    classDef improveClass fill:#e8f5e8
    classDef issueClass fill:#fff3e0
    classDef externalClass fill:#fce4ec
    
    class EvalCore,EvalData,EvalResults evalClass
    class AICore,AnalysisData,JupyterReports aiClass
    class ImproveCore,SuggestionData,PriorityMatrix improveClass
    class IssueCore,IssueData,EffectMeasurement issueClass
    class GitHub,PersonalData,ExternalTools externalClass
```

## 🔄 メインシーケンス：アルゴリズム開発・評価・改善サイクル

```mermaid
sequenceDiagram
    participant Dev as 開発者
    participant GH as GitHub
    participant GA as GitHub Actions
    participant Local as ローカル環境
    participant AI as AIエージェント
    participant Issues as GitHub Issues

    Note over Dev, Issues: 1. 開発フェーズ
    Dev->>GH: アルゴリズム仕様書・ソースコード Push
    GH->>GA: 自動トリガー
    GA->>Local: 性能評価エンジン実行（セルフホスト型ランナー）
    
    Note over Dev, Issues: 2. データ処理フェーズ
    Local->>Local: 動画データ読み込み
    Local->>Local: コア機能エンジン（動画→CSV変換）
    Local->>Local: 性能評価エンジン実行
    Local->>Local: 評価結果生成
    
    Note over Dev, Issues: 3. 課題分析フェーズ
    Local->>AI: 評価結果送信
    AI->>AI: 課題分析実行
    AI->>Local: 課題分析結果返送
    Local->>Local: 課題分析エンジン実行
    Local->>Local: 分析レポート生成
    Local->>Dev: 分析レポート通知
    
    Note over Dev, Issues: 4. 改善提案フェーズ
    Local->>AI: 分析結果送信
    AI->>AI: 改善提案生成
    AI->>Local: 改善提案返送
    Local->>Local: 改善案検討エンジン実行
    Local->>Local: 改善提案レポート生成
    Local->>Dev: 改善提案レポート通知
    Dev->>Local: 改善提案確認・必要に応じて介入
    
    Note over Dev, Issues: 5. 課題管理フェーズ
    Local->>Issues: 課題自動生成
    Dev->>Issues: 優先度判断・対策対象選択
    Dev->>GH: 修正実装 Push
    GH->>GA: 自動トリガー
    GA->>Local: 効果測定実行
    Local->>Local: 修正前後比較分析
    Local->>Issues: 効果測定結果自動コメント
    Dev->>Issues: 課題クローズ
```

## 🔄 詳細シーケンス：課題管理システム

```mermaid
sequenceDiagram
    participant AI as AI分析エンジン
    participant IG as 課題生成エンジン
    participant UI as 優先度選択UI
    participant Dev as 開発者
    participant Issues as GitHub Issues
    participant GA as GitHub Actions
    participant EM as 効果測定エンジン

    Note over AI, EM: 課題生成・管理フロー
    AI->>IG: 分析結果送信
    IG->>IG: 課題自動生成
    IG->>UI: 生成課題一覧表示
    Dev->>UI: 生成課題確認・必要に応じて調整
    Dev->>UI: 優先度判断・対策対象選択
    UI->>Issues: 選択課題をGitHub Issuesに作成
    Dev->>Issues: 課題詳細確認・調整
    
    Note over AI, EM: 修正・効果測定フロー
    Dev->>Issues: 修正実装開始
    Dev->>GA: 修正コード Push
    GA->>EM: 効果測定実行
    EM->>EM: 修正前後比較分析
    EM->>Issues: 効果測定結果自動コメント
    Dev->>Issues: 課題クローズ
```

## 🔄 詳細シーケンス：CI/CDパイプライン

```mermaid
sequenceDiagram
    participant Dev as 開発者
    participant GH as GitHub
    participant GA as GitHub Actions
    participant Local as ローカル環境
    participant AI as AIエージェント
    participant Notify as 通知システム

    Note over Dev, Notify: CI/CDパイプライン実行フロー
    Dev->>GH: コード Push
    GH->>GA: 自動トリガー
    GA->>Local: セルフホスト型ランナー起動
    Local->>Local: テスト実行
    Local->>Local: 評価実行
    Local->>AI: 評価結果送信
    AI->>AI: AI分析実行
    AI->>Local: 分析結果返送
    Local->>Local: レポート生成
    Local->>Notify: 結果通知（Slack/Email）
    Notify->>Dev: 開発者に通知
```

## 🔄 詳細シーケンス：AI分析エンジン

```mermaid
sequenceDiagram
    participant PE as 性能評価エンジン
    participant AI as AI分析エンジン
    participant JN as Jupyter Notebook
    participant FM as フロンティアモデル
    participant Report as 分析レポート

    Note over PE, Report: AI分析実行フロー
    PE->>AI: 評価結果送信
    AI->>AI: データ前処理
    AI->>FM: 課題分析リクエスト
    FM->>AI: 課題分析結果
    AI->>AI: 改善提案生成
    AI->>FM: 改善提案リクエスト
    FM->>AI: 改善提案結果
    AI->>JN: Jupyter Notebook生成
    AI->>Report: 分析レポート生成
    AI->>AI: 結果保存・整理
```

## 🔄 詳細シーケンス：効果測定システム

```mermaid
sequenceDiagram
    participant GA as GitHub Actions
    participant EM as 効果測定エンジン
    participant DB as データベース
    participant Issues as GitHub Issues
    participant Report as 効果測定レポート

    Note over GA, Report: 効果測定実行フロー
    GA->>EM: 効果測定実行トリガー
    EM->>DB: 修正前データ取得
    EM->>EM: 修正後データ生成
    EM->>EM: 比較分析実行
    EM->>EM: 改善効果算出
    EM->>Issues: 効果測定結果自動コメント
    EM->>Report: 効果測定レポート生成
    EM->>DB: 測定結果保存
```

## 📊 シーケンス図の凡例

### 参加者（Actor）
- **開発者**: 人間の開発者
- **GitHub**: オンライン環境のリポジトリ管理
- **GitHub Actions**: CI/CDパイプライン
- **ローカル環境**: ローカル環境の実行エンジン群
- **AIエージェント**: フロンティアモデル（OpenAI GPT/Claude）
- **GitHub Issues**: 課題管理システム

### メッセージの種類
- **実線矢印**: 同期通信（即座に応答）
- **点線矢印**: 非同期通信（応答を待たない）
- **Note**: 処理フェーズの説明

### 処理タイミング
- **即座処理**: 開発者のアクションに応じて即座に実行
- **夜間処理**: 開発者退勤後の自動実行
- **翌朝確認**: 夜間処理完了後の結果確認



### 処理フェーズ
1. **開発フェーズ**: コードのPushから評価実行まで
2. **データ処理フェーズ**: 動画データの処理から評価結果生成まで
3. **AI分析フェーズ**: AIによる課題分析と改善提案生成
4. **課題管理フェーズ**: 課題の生成から管理まで
5. **効果測定フェーズ**: 修正前後の比較分析

## 🎯 シーケンス図の特徴

### 自動化ポイント
- **継続的評価**: コードPushで自動トリガー
- **AI分析**: 評価結果の自動分析
- **課題生成**: AI分析結果からの自動課題生成
- **効果測定**: 修正前後の自動比較分析

### 人間介入ポイント
- **改善提案確認**: 改善提案レポートの確認・必要に応じて介入
- **生成課題確認**: AI生成課題の確認・必要に応じて調整
- **優先度判断**: 抽出された課題の優先度判断
- **対策対象選択**: どの課題を対策対象とするかの選択
- **修正実装**: 実際のコード修正
- **課題クローズ**: 効果測定後の課題完了判断

### 非同期処理
- **夜間処理**: 開発者が退勤後の自動処理
- **翌朝確認**: 翌朝に結果を確認する仕組み
- **通知システム**: 処理完了時の自動通知
- **自動処理**: 評価・分析までは自動で処理を継続

---
**作成日**: 2024-07-25  
**最終更新**: 2024-07-25  
**バージョン**: 1.0 